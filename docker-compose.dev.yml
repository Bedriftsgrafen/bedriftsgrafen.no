# =============================================================================
# DEV STACK - Host Network Mode
# =============================================================================
#
# Denne filen definerer dev-containere som:
# - Kjører på HOST-nettverket (ingen Docker-nettverk opprettes)
# - Kobler direkte til localhost:5432 for database
# - Har hot-reload og debugging
# - Påvirker IKKE iptables eller andre containere
#
# KRAV: Prod må kjøre først (for database tilgang på localhost:5432)
#
# Start:  docker compose -f docker-compose.dev.yml up -d
# Stopp:  docker compose -f docker-compose.dev.yml down
# Logs:   docker compose -f docker-compose.dev.yml logs -f
#
# TILGANG:
#   - Backend API: http://localhost:8001
#   - Frontend:    http://localhost:5173
#   - Debugger:    localhost:5678
#
# =============================================================================

name: bedriftsgrafenno-dev

services:
  backend-dev:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: bedriftsgrafen-backend-dev
    restart: unless-stopped
    init: true
    network_mode: host
    env_file:
      - .env
    volumes:
      - ./backend:/app
      - ./scripts:/app/ops_scripts
    environment:
      # Direct localhost access - no Docker networking!
      - DATABASE_HOST=localhost
      - DATABASE_PORT=5432
      # Override port to avoid conflict with prod backend
      - API_PORT=8001
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          memory: 512M
    # Simple command - debugpy can be added manually if needed
    command: python -m uvicorn main:app --host 0.0.0.0 --port 8001 --reload

  frontend-dev:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: development
    container_name: bedriftsgrafen-frontend-dev
    restart: unless-stopped
    init: true
    network_mode: host
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:8001
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 1G
        reservations:
          memory: 256M
    depends_on:
      - backend-dev

# NO networks section! Host mode = no Docker networks created
